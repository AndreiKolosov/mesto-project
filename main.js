(()=>{"use strict";var e={formSelector:".form",inputSelector:".form__item",buttonSelector:".form__save-button",buttonInactiveClass:"form__save-button_disabled",errorElementClass:"form__item-error_active",inputErrorClass:"form__item_type_error"},t=function(e,t){e.classList.add(t.buttonInactiveClass),e.disabled=!0},n=function(e,n,o){var r=e.querySelector(o.buttonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(n)?function(e,t){e.classList.remove(t.buttonInactiveClass),e.disabled=!1}(r,o):t(r,o)};function o(e){e.classList.add("popup_opened"),document.addEventListener("keydown",c)}function r(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",c)}function c(e){"Escape"===e.key&&r(document.querySelector(".popup_opened"))}var a=document.querySelector(".profile__name"),i=document.querySelector(".profile__description"),u=document.querySelector(".profile__avatar"),s=document.querySelector("#editor-form"),l=document.querySelector("#card-form"),d=document.querySelector("#avatar-form"),f=s.querySelector("#user-name"),_=s.querySelector("#user-description"),m=l.querySelector("#place-name"),v=l.querySelector("#place-img-link"),p=d.querySelector("#user-avatar"),h=document.querySelector(".galery__list"),y={baseUrl:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"32e69527-8018-4c7f-823e-614d86c48870","Content-Type":"application/json"}},S=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};var b=document.querySelector(".popup__image"),q=document.querySelector(".popup__img-caption"),L=document.querySelector(".popup_type_img"),g=document.querySelector(".popup_type_card-adder"),E=document.querySelector(".popup_type_profile-editor"),k=document.querySelector(".popup_type_avatar-editor"),C=document.querySelector(".popup_type_confirm"),x=C.querySelector(".form__save-button");function U(e){o(C);var t=function t(){return function(e,t){var n,o=document.getElementById(e._id);x.textContent="Удаление...",(n=e._id,fetch("".concat(y.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:y.headers}).then((function(e){return S(e)})).catch((function(e){console.log(e)}))).then((function(){x.removeEventListener("click",t),o.remove(),r(C)})).catch((function(e){console.log(e.message)})).finally((function(){x.textContent="Да"}))}(e,t)};x.addEventListener("click",t),C.addEventListener("click",(function(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-button")||"Escape"===e.key)&&x.removeEventListener("click",t)}))}function P(e){var t=e.target.closest(".card__image");o(L),b.src=t.src,b.alt=t.alt,q.textContent=t.alt}var A=document.querySelector(".card-template").content;function T(e,t){var n=A.querySelector(".card").cloneNode(!0),o=n.querySelector(".card__like-button"),r=n.querySelector(".card__name"),c=n.querySelector(".card__image"),a=n.querySelector(".card__like-counter"),i=n.querySelector(".card__remove-button"),u=e.likes,s=Boolean(u.find((function(e){return e._id===t})));return t!==e.owner._id&&i.classList.add("card__remove-button_invisible"),e.likes.length>0&&(a.classList.add("card__like-counter_visible"),a.textContent=e.likes.length,s&&o.classList.add("card__like-button_active")),n.id=e._id,r.textContent=e.name,c.src=e.link,c.alt=e.name,function(e){var t=e.closest(".card"),n=t.querySelector(".card__like-counter");e.addEventListener("click",(function(){var o;e.classList.contains("card__like-button_active")?(o=t.id,fetch("".concat(y.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:y.headers}).then((function(e){return S(e)})).catch((function(e){console.log(e)}))).then((function(t){n.textContent=t.likes.length,n.classList.remove("card__like-counter_visible"),e.classList.remove("card__like-button_active")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(y.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:y.headers}).then((function(e){return S(e)})).catch((function(e){console.log(e)}))}(t.id).then((function(t){n.textContent=t.likes.length,n.classList.add("card__like-counter_visible"),e.classList.add("card__like-button_active")})).catch((function(e){console.log(e)}))}))}(o),c.addEventListener("click",P),i.addEventListener("click",(function(){return U(e)})),n}var j=document.querySelector(".profile__edit-button"),w=document.querySelector(".profile__add-button"),I=document.querySelector(".profile__avatar-container"),N=Array.from(document.querySelectorAll(".popup")),O=[fetch("".concat(y.baseUrl,"/users/me"),{headers:y.headers}).then((function(e){return S(e)})).catch((function(e){return console.log(e),Promise.reject(e)})),fetch("".concat(y.baseUrl,"/cards"),{headers:y.headers}).then((function(e){return S(e)})).catch((function(e){return console.log(e),Promise.reject(e)}))];N.forEach((function(e){e.addEventListener("click",(function(t){(t.target.classList.contains("popup__close-button")||t.target.classList.contains("popup"))&&r(e)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector));n(e,o,t),o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){var o=e.querySelector(".".concat(t.id,"_error"));t.validity.valid?function(e,t,n){e.classList.remove(n.inputErrorClass),t.classList.remove(n.errorElementClass),t.textContent=""}(t,o,n):function(e,t,n,o){e.classList.add(o.inputErrorClass),t.classList.add(o.errorElementClass),t.textContent=n}(t,o,t.validationMessage,n)}(e,r,t),n(e,o,t)}))}))}(t,e)}))}(e),I.addEventListener("click",(function(){o(k)})),j.addEventListener("click",(function(){f.value=a.textContent,_.value=i.textContent,o(E)})),w.addEventListener("click",(function(){o(g)})),s.addEventListener("submit",(function(){var n,o,c=s.querySelector(".form__save-button");c.textContent="Сохранение...",(n=f.value,o=_.value,fetch("".concat(y.baseUrl,"/users/me"),{method:"PATCH",headers:y.headers,body:JSON.stringify({name:n,about:o})}).then((function(e){return S(e)})).catch((function(e){console.log(e)}))).then((function(n){a.textContent=n.name,i.textContent=n.about,t(c,e),r(E)})).catch((function(e){console.log(e)})).finally((function(){c.textContent="Сохранить"}))})),l.addEventListener("submit",(function(){var n,o,c=l.querySelector(".form__save-button");c.textContent="Сохранение...",(n=m.value,o=v.value,fetch("".concat(y.baseUrl,"/cards"),{method:"POST",headers:y.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return S(e)})).catch((function(e){console.log(e)}))).then((function(n){h.prepend(T(n,n.owner._id)),l.reset(),t(c,e),r(g)})).catch((function(e){console.log(e)})).finally((function(){c.textContent="Создать"}))})),d.addEventListener("submit",(function(){var n,o=d.querySelector(".form__save-button");o.textContent="Сохранение...",(n=p.value,fetch("".concat(y.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:y.headers,body:JSON.stringify({avatar:n})}).then((function(e){return S(e)})).catch((function(e){return console.log(e),Promise.reject(e)}))).then((function(n){u.src=n.avatar,d.reset(),t(o,e),r(k)})).catch((function(e){console.log(e)})).finally((function(){o.textContent="Сохранить"}))})),Promise.all(O).then((function(e){var t=e[0],n=e[1];a.textContent=t.name,i.textContent=t.about,u.src=t.avatar,function(e,t,n){e.forEach((function(e){var o=T(e,t);n.append(o)}))}(n,t._id,h)})).catch((function(e){console.log(e)}))})();